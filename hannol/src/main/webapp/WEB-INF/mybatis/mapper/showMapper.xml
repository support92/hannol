<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="show">
	<select id="listShowTime" parameterType="map" resultType="String">
		select startTime from showStartTIme
		where schCode = (
		    select schCode
		    from showSch
		    where screenDate = #{screenDate} and showInfoCode = #{showInfoCode})
	</select>
	
	<select id="listShow" parameterType="map" resultType="com.sp.show.Show">
		select s.showCode, showName, memo, saveFilename, s.gubunCode, showInfoCode, facilityCode, name
		from show s 
		join showGubun sg
		    on s.GUBUNCODE = sg.GUBUNCODE
		join (select showCode, showInfoCode, s.facilityCode, name
		    from showInfo s join facility f
		        on f.facilityCode = s.facilityCode
		    where showInfoCode in (
		        select showInfoCode
		        from showSch
		        where screenDate = #{screenDate})) si
		    on s.showCode = si.showCode
		where s.gubunCode = #{gubunCode}
	</select>
	
	<select id="readShowInfo" parameterType="map" resultType="com.sp.show.Show">
		select s.showCode, showName, memo, saveFilename, name,
		    startDate, endDate, runningTime, saveLocFilename
		from show s 
		join showGubun sg
		    on s.GUBUNCODE = sg.GUBUNCODE
		join (select showCode, showInfoCode, s.facilityCode, name, 
		        to_char(startDate, 'yyyy-mm-dd') startDate, to_char(endDate, 'yyyy-mm-dd') endDate, runningTime, f.saveLocFilename
		    from showInfo s join facility f
		        on f.facilityCode = s.facilityCode
		    where showInfoCode in (
		        select showInfoCode
		        from showSch
		        where screenDate = #{screenDate})) si
		    on s.showCode = si.showCode
		where showInfoCode = #{showInfoCode}
	</select>
	
</mapper>
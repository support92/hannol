<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">
	<select id="loginMember" parameterType="String" resultType="com.sp.member.Member">
		SELECT usersCode, memberId, memberPwd, memberName, authority FROM member1 WHERE memberId=#{memberId} AND enabled=1
	</select>
	
	
	<!-- usersCode sequence -->
	<select id="usersSeq" resultType="Integer">
		select users_seq.nextval from dual
	</select>
	
	<!-- 유저 insert -->
	<insert id="insertUsers" parameterType="Integer">
		insert into users(usersCode, authority)
		values(#{usersCode}, 'ROLE_USER')
	</insert>
	
	<!-- member1 insert -->
	<insert id="insertMember1" parameterType="com.sp.member.Member">
		insert into member1(usersCode, memberId, memberPwd, memberName, enabled, authority)
		values(#{usersCode}, #{memberId}, #{memberPwd}, #{memberName}, #{enabled}, #{authority})
	</insert>
	
	<!-- member2 insert -->
	<insert id="insertMember2" parameterType="com.sp.member.Member">
		insert into member2(usersCode, help, email, birth, post, addr1, addr2, tel, joinDate, joinPath, loginDate, gradeCode)
		values(#{usersCode}, #{help}, #{email}, #{birth}, #{post}, #{addr1}, #{addr2}, #{tel}, sysdate, #{joinPath}, #{loginDate}, 3)
	</insert>
	
	<select id="readMember" parameterType="String" resultType="com.sp.member.Member">
      SELECT usersCode, memberId, memberName, authority FROM member1
      WHERE memberId = #{userId}
   </select>
   
   <update id="updateLastLogin" parameterType="Long">
      UPDATE member2 SET loginDate = SYSDATE WHERE usersCode = #{usersCode}
   </update>

	<update id="updatePwd" parameterType="com.sp.member.Member">
		update member1 set memberPwd = #{memberPwd} 
		where usersCode = #{usersCode}
	</update>   
	
</mapper>
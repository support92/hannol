<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">
	<insert id="insertReview" parameterType="com.sp.review.Review">
		insert into Review(reviewCode, content, reviewDate, usersCode)
		values(review_seq.nextval, #{content}, #{reviewDate}, #{usersCode})	
	</insert>
	
	
	<!-- 후기 개수 -->
	<select id="dataCount" resultType="Integer">
		select nvl(count(*), 0) from review r
	</select>
	 
	<!-- 후기 리스트 -->
	<select id="listReview" parameterType="map" resultType="com.sp.review.Review">
		select * from (
		    select rownum rnum, tb.* from (
		        select r.reviewCode, content, to_char(reviewdate, 'yyyy-mm-dd') reviewdate, r.userscode, nvl(likecount, 0) likecount, m.memberId
		        from review r join member1 m
		        	on r.userscode = m.userscode
		        left outer join (
		            select reviewcode, nvl(count(usersCode), 0) likeCount
		            from reviewlike
		            group by reviewCode
		        ) a on r.reviewCode = a.reviewCode
<![CDATA[	
		    ) tb where rownum <= #{end}
		) where rnum >= #{start}
]]>	
        order by likecount desc
	</select>
	
</mapper>
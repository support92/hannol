<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="magic">
	<select id="checkTicket" parameterType="Long" resultType="Integer">
		SELECT COUNT(*) FROM ticket t
		LEFT JOIN payment p ON p.paycode =  t.paycode
		WHERE userscode=#{usersCode}
		AND TO_CHAR(SYSDATE, 'YYYY-MM-DD') BETWEEN startDate AND endDate
	</select>
	
	<select id="dataCount" parameterType="map" resultType="Integer">
	 	SELECT COUNT(*)
        FROM facility f
        LEFT JOIN rides r ON f.facilityCode = r.facilityCode
        WHERE state=1 AND f.gubunCode=1
        <if test="searchValue !=null and searchValue !=''">
          AND INSTR(name, #{searchValue}) &gt; 0
        </if>
        <if test="themeCode != 0">
        	AND themeCode = #{themeCode}
        </if>
	</select>
	
	<select id="listRides" parameterType="map" resultType="com.sp.magicpass.MagicPass">
		SELECT * FROM(
		    SELECT ROWNUM rnum, tb.* FROM (
		        SELECT f.facilityCode, name, state, saveMainFileName, f.gubunCode, themeCode, congestion
		        FROM facility f
		        LEFT JOIN rides r ON f.facilityCode = r.facilityCode
		        WHERE state=1 AND f.gubunCode=1
		        <if test="searchValue !=null and searchValue !=''">
		          AND INSTR(name, #{searchValue}) &gt; 0
		        </if>
		        <if test="themeCode != 0">
		        	AND themeCode = #{themeCode}
		        </if>
		        ORDER BY congestion DESC
		    ) tb
		    WHERE ROWNUM &lt;=#{end}
		) WHERE rnum &gt;=#{start}
	</select>
</mapper>
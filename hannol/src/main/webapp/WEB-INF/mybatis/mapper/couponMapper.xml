<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="coupon">
	<select id="dataCount" parameterType="map" resultType="Integer">
		SELECT NVL(COUNT(*),0)
		FROM 
		(
    		SELECT g.payCode, usersCode
    		FROM gift g
    		JOIN payment p ON g.payCode = p.payCode
    		WHERE usersCode = #{usersCode}
		)
	</select>
	
	<select id="ajaxGiftCouponList" parameterType="map" resultType="com.sp.coupon.Coupon">
		SELECT * FROM (
    		SELECT ROWNUM rnum, tb.* FROM(
        		SELECT g.payCode, usersCode, giftCode, TO_CHAR(endDate,'YYYY-MM-DD') endDate, TO_CHAR(useDate,'YYYY-MM-DD') useDate, goodsName, gubunName 
        		FROM gift g
        		JOIN payment p ON g.payCode = p.payCode
        		JOIN goods gs ON g.goodsCode = gs.goodsCode
        		JOIN goodsGubun gg ON gs.gubunCode = gg.gubunCode
        		WHERE usersCode = #{usersCode}
        <![CDATA[
    		)tb WHERE ROWNUM <= #{end}
		)WHERE rnum >= #{start}
		]]>
	</select>
</mapper>